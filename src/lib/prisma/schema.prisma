generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [uuidOssp(map: "uuid-ossp")]
}

model ApplicationTypes {
  Id                 Int                  @id(map: "PK_ApplicationTypes") @default(autoincrement())
  Name               String
  Description        String?
  ProjectImports     ProjectImports[]
  Projects           Projects[]
  SystemVersions     SystemVersions[]
  SoftwareUpdates    SoftwareUpdates[]
  ProductDefinitions ProductDefinitions[]
}

model Authors {
  UserId    Int
  ProjectId Int
  CanUpdate Boolean?
  Project   Projects @relation(fields: [ProjectId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_Authors_Projects_ProjectId")
  User      Users    @relation(fields: [UserId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_Authors_Users_UserId")

  @@id([UserId, ProjectId], map: "PK_Authors_UserId_ProjectId")
}

model Groups {
  Id             Int              @id(map: "PK_Groups") @default(autoincrement())
  Name           String
  Description    String?
  OwnerId        Int
  Users          Users[]
  Owner          Organizations    @relation(fields: [OwnerId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_Groups_Organizations_OwnerId")
  ProjectImports ProjectImports[]
  Projects       Projects[]

  @@index([OwnerId], map: "IX_Groups_OwnerId")
}

model OrganizationMembershipInvites {
  Token          String        @id(map: "PK_OrganizationMembershipInvites") @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  Email          String
  Expires        DateTime      @default(dbgenerated("(CURRENT_DATE + 7)")) @db.Timestamp(6)
  Redeemed       Boolean       @default(false)
  InvitedById    Int
  OrganizationId Int
  Roles          Int[]         @default([])
  Groups         Int[]         @default([])
  DateCreated    DateTime?     @default(now()) @db.Timestamp(6)
  DateUpdated    DateTime?     @updatedAt @db.Timestamp(6)
  Organization   Organizations @relation(fields: [OrganizationId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_OrganizationMembershipInvites_Organizations_OrganizationId")
  InvitedBy      Users         @relation(fields: [InvitedById], references: [Id], onDelete: NoAction, onUpdate: NoAction, map: "FK_OrganizationMembershipInvites_Users_InvitedById")

  @@index([InvitedById], map: "IX_OrganizationMembershipInvites_InvitedById")
  @@index([OrganizationId], map: "IX_OrganizationMembershipInvites_OrganizationId")
}

model Organizations {
  Id                            Int                             @id(map: "PK_Organizations") @default(autoincrement())
  Name                          String
  WebsiteUrl                    String?
  BuildEngineUrl                String?
  BuildEngineApiAccessToken     String?
  LogoUrl                       String?
  UseDefaultBuildEngine         Boolean                         @default(true)
  PublicByDefault               Boolean                         @default(true)
  ContactEmail                  String?
  Groups                        Groups[]
  OrganizationMembershipInvites OrganizationMembershipInvites[]
  Users                         Users[]
  ProductDefinitions            ProductDefinitions[]
  ProjectImports                ProjectImports[]
  Projects                      Projects[]
  UserRoles                     UserRoles[]
  Stores                        Stores[]                        @relation("OrganizationsToStores")
  ManagedStores                 Stores[]                        @relation("ManagedStores")
}

model ProductArtifacts {
  ProductId          String        @db.Uuid
  BuildEngineBuildId Int
  ArtifactType       String
  Url                String?
  FileSize           BigInt?
  ContentType        String?
  DateCreated        DateTime?     @default(now()) @db.Timestamp(6)
  DateUpdated        DateTime?     @updatedAt @db.Timestamp(6)
  ProductBuild       ProductBuilds @relation(fields: [ProductId, BuildEngineBuildId], references: [ProductId, BuildEngineBuildId], onDelete: Cascade, onUpdate: NoAction, map: "FK_ProductArtifacts_ProductBuilds_ProductId_BuildEngineBuildId")
  Product            Products      @relation(fields: [ProductId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_ProductArtifacts_Products_ProductId")

  @@id([ProductId, BuildEngineBuildId, ArtifactType], map: "PK_ProductArtifacts_ProductId_BEBuildId_ArtifactType")
  @@index([ProductId], map: "IX_ProductArtifacts_ProductId")
}

model ProductBuilds {
  ProductId           String                @db.Uuid
  BuildEngineBuildId  Int
  Version             String?
  DateCreated         DateTime?             @default(now()) @db.Timestamp(6)
  DateUpdated         DateTime?             @updatedAt @db.Timestamp(6)
  Success             Boolean?
  AppBuilderVersion   String?
  TransitionId        Int?
  ProductArtifacts    ProductArtifacts[]
  Product             Products              @relation(name: "Products_ProductBuilds_all", fields: [ProductId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_ProductBuilds_Products_ProductId")
  Current             Products?             @relation("Products_ProductBuilds_CurrentBuild")
  // A build may have multiple publications if a SuperAdmin jumps directly from Synchronize Data to Product Publish
  ProductPublications ProductPublications[]
  Transition          ProductTransitions?   @relation(fields: [TransitionId], references: [Id], onDelete: SetNull, onUpdate: NoAction, map: "FK_ProductBuilds_ProductTransitions_TransitionId")

  @@id([ProductId, BuildEngineBuildId], map: "PK_ProductBuilds_ProductId_BuildEngineBuildId")
  @@index([TransitionId], map: "IX_ProductBuilds_TransitionId")
}

model ProductDefinitions {
  Id                       Int                  @id(map: "PK_ProductDefinitions") @default(autoincrement())
  Name                     String
  Description              String?
  WorkflowId               Int
  RebuildWorkflowId        Int?
  RepublishWorkflowId      Int?
  Properties               String?
  AllowAllApplicationTypes Boolean              @default(true)
  Organizations            Organizations[]
  ApplicationTypes         ApplicationTypes[]
  RebuildWorkflow          WorkflowDefinitions? @relation("ProductDefinitions_RebuildWorkflowIdToWorkflowDefinitions", fields: [RebuildWorkflowId], references: [Id], onDelete: Restrict, onUpdate: NoAction, map: "FK_ProductDefinitions_WorkflowDefinitions_RebuildWorkflowId")
  RepublishWorkflow        WorkflowDefinitions? @relation("ProductDefinitions_RepublishWorkflowIdToWorkflowDefinitions", fields: [RepublishWorkflowId], references: [Id], onDelete: Restrict, onUpdate: NoAction, map: "FK_ProductDefinitions_WorkflowDefinitions_RepublishWorkflowId")
  Workflow                 WorkflowDefinitions  @relation("ProductDefinitions_WorkflowIdToWorkflowDefinitions", fields: [WorkflowId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_ProductDefinitions_WorkflowDefinitions_WorkflowId")
  Products                 Products[]

  @@index([RebuildWorkflowId], map: "IX_ProductDefinitions_RebuildWorkflowId")
  @@index([RepublishWorkflowId], map: "IX_ProductDefinitions_RepublishWorkflowId")
  @@index([WorkflowId], map: "IX_ProductDefinitions_WorkflowId")
}

model ProductPublications {
  ProductId            String              @db.Uuid
  BuildEngineBuildId   Int
  BuildEngineReleaseId Int
  Channel              String?
  LogUrl               String?
  PublishLink          String?
  Success              Boolean?
  DateCreated          DateTime?           @default(now()) @db.Timestamp(6)
  DateUpdated          DateTime?           @updatedAt @db.Timestamp(6)
  Package              String?
  DateResolved         DateTime?           @db.Timestamp(6)
  TransitionId         Int?
  ProductBuild         ProductBuilds       @relation(fields: [ProductId, BuildEngineBuildId], references: [ProductId, BuildEngineBuildId], onDelete: Cascade, onUpdate: NoAction, map: "FK_ProductPublications_ProductBuilds_ProductId_BEBuildId")
  Product              Products            @relation(name: "Products_ProductPublications_all", fields: [ProductId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_ProductPublications_Products_ProductId")
  Current              Products?           @relation("Products_ProductPublications_CurrentRelease")
  Transition           ProductTransitions? @relation(fields: [TransitionId], references: [Id], onDelete: SetNull, onUpdate: NoAction, map: "FK_ProductPublications_ProductTransitions_TransitionId")

  @@id([ProductId, BuildEngineReleaseId], map: "PK_ProductPublications_ProductId_BuildEngineReleaseId")
  @@index([BuildEngineBuildId], map: "IX_ProductPublications_BuildEngineBuildId")
  @@index([Package], map: "IX_ProductPublications_Package")
  @@index([ProductId], map: "IX_ProductPublications_ProductId")
  @@index([TransitionId], map: "IX_ProductPublications_TransitionId")
}

model ProductTransitions {
  Id                  Int                   @id(map: "PK_ProductTransitions") @default(autoincrement())
  ProductId           String                @db.Uuid
  // Since users are never deleted, only locked, this should be fine
  UserId              Int?
  AllowedUserNames    String?
  InitialState        String?
  DestinationState    String?
  Command             String?
  DateTransition      DateTime?             @db.Timestamp(6)
  Comment             String?
  TransitionType      Int                   @default(1)
  WorkflowType        Int?
  Product             Products              @relation(fields: [ProductId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_ProductTransitions_Products_ProductId")
  User                Users?                @relation(fields: [UserId], references: [Id])
  QueueRecords        QueueRecords[]
  ProductBuilds       ProductBuilds[]
  ProductPublications ProductPublications[]

  @@index([ProductId], map: "IX_ProductTransitions_ProductId")
}

model QueueRecords {
  ProductTransitionId Int
  Queue               String
  JobType             String
  JobId               String
  ProductTransition   ProductTransitions @relation(fields: [ProductTransitionId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_QueueRecords_ProductTransitions_ProductTransitionId")

  @@id([Queue, JobId], map: "IX_QueueRecords_Queue_JobId")
  @@index([ProductTransitionId], map: "IX_QueueRecords_ProductTransitionId")
}

model Products {
  Id                  String                @id(map: "PK_Products") @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  ProjectId           Int
  ProductDefinitionId Int
  StoreId             Int
  StoreLanguageId     Int?
  DateCreated         DateTime?             @default(now()) @db.Timestamp(6)
  DateUpdated         DateTime?             @updatedAt @db.Timestamp(6)
  BuildEngineJobId    Int
  CurrentBuildId      Int?
  DateBuilt           DateTime?             @db.Timestamp(6)
  CurrentReleaseId    Int?
  DatePublished       DateTime?             @db.Timestamp(6)
  PublishLink         String?
  VersionBuilt        String?
  Properties          String?
  PackageName         String?
  ProductArtifacts    ProductArtifacts[]
  // Note: this should only set CurrentBuildId to null
  CurrentBuild        ProductBuilds?        @relation(name: "Products_ProductBuilds_CurrentBuild", fields: [Id, CurrentBuildId], references: [ProductId, BuildEngineBuildId], onDelete: SetNull, onUpdate: NoAction, map: "FK_Products_ProductBuilds_CurrentBuildId")
  ProductBuilds       ProductBuilds[]       @relation("Products_ProductBuilds_all")
  // Note: this should only set CurrentReleaseId to null
  CurrentRelease      ProductPublications?  @relation(name: "Products_ProductPublications_CurrentRelease", fields: [Id, CurrentReleaseId], references: [ProductId, BuildEngineReleaseId], onDelete: SetNull, onUpdate: NoAction, map: "FK_Products_ProductPublications_CurrentReleaseId")
  ProductPublications ProductPublications[] @relation("Products_ProductPublications_all")
  ProductTransitions  ProductTransitions[]
  ProductDefinition   ProductDefinitions    @relation(fields: [ProductDefinitionId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_Products_ProductDefinitions_ProductDefinitionId")
  Project             Projects              @relation(fields: [ProjectId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_Products_Projects_ProjectId")
  StoreLanguage       StoreLanguages?       @relation(fields: [StoreLanguageId], references: [Id], onDelete: Restrict, onUpdate: NoAction, map: "FK_Products_StoreLanguages_StoreLanguageId")
  Store               Stores                @relation(fields: [StoreId], references: [Id], onDelete: Restrict, onUpdate: NoAction, map: "FK_Products_Stores_StoreId")
  UserTasks           UserTasks[]
  WorkflowInstance    WorkflowInstances?
  ProductUserChanges  ProductUserChanges[]
  SoftwareUpdates     SoftwareUpdates[]

  @@unique([Id, CurrentBuildId])
  @@unique([Id, CurrentReleaseId])
  @@index([ProductDefinitionId], map: "IX_Products_ProductDefinitionId")
  @@index([ProjectId], map: "IX_Products_ProjectId")
  @@index([StoreId], map: "IX_Products_StoreId")
  @@index([StoreLanguageId], map: "IX_Products_StoreLanguageId")
}

model ProjectImports {
  Id              Int               @id(map: "PK_ProjectImports") @default(autoincrement())
  ImportData      String?
  TypeId          Int?
  OwnerId         Int?
  GroupId         Int?
  OrganizationId  Int?
  DateCreated     DateTime?         @default(now()) @db.Timestamp(6)
  DateUpdated     DateTime?         @updatedAt @db.Timestamp(6)
  ApplicationType ApplicationTypes? @relation(fields: [TypeId], references: [Id], onUpdate: NoAction, map: "FK_ProjectImports_ApplicationTypes_TypeId")
  Group           Groups?           @relation(fields: [GroupId], references: [Id], onUpdate: NoAction, map: "FK_ProjectImports_Groups_GroupId")
  Organization    Organizations?    @relation(fields: [OrganizationId], references: [Id], onUpdate: NoAction, map: "FK_ProjectImports_Organizations_OrganizationId")
  Owner           Users?            @relation(fields: [OwnerId], references: [Id], onUpdate: NoAction, map: "FK_ProjectImports_Users_OwnerId")
  Projects        Projects[]

  @@index([GroupId], map: "IX_ProjectImports_GroupId")
  @@index([OrganizationId], map: "IX_ProjectImports_OrganizationId")
  @@index([OwnerId], map: "IX_ProjectImports_OwnerId")
  @@index([TypeId], map: "IX_ProjectImports_TypeId")
}

model Projects {
  Id                      Int              @id(map: "PK_Projects") @default(autoincrement())
  Name                    String
  TypeId                  Int
  Description             String?
  OwnerId                 Int
  GroupId                 Int
  OrganizationId          Int
  Language                String
  IsPublic                Boolean          @default(true)
  DateCreated             DateTime?        @default(now()) @db.Timestamp(6)
  DateUpdated             DateTime?        @updatedAt @db.Timestamp(6)
  DateArchived            DateTime?        @db.Timestamp(6)
  AllowDownloads          Boolean          @default(true)
  AutoPublishOnRebuild    Boolean          @default(false)
  RebuildOnSoftwareUpdate Boolean          @default(false)
  BuildEngineProjectId    Int              @default(0)
  RepositoryUrl           String?
  DateActive              DateTime?        @db.Timestamp(6)
  ImportId                Int?
  Authors                 Authors[]
  Products                Products[]
  ApplicationType         ApplicationTypes @relation(fields: [TypeId], references: [Id], onUpdate: NoAction, map: "FK_Projects_ApplicationTypes_TypeId")
  Group                   Groups           @relation(fields: [GroupId], references: [Id], onUpdate: NoAction, map: "FK_Projects_Groups_GroupId")
  Organization            Organizations    @relation(fields: [OrganizationId], references: [Id], onUpdate: NoAction, map: "FK_Projects_Organizations_OrganizationId")
  ProjectImport           ProjectImports?  @relation(fields: [ImportId], references: [Id], onDelete: Restrict, onUpdate: NoAction, map: "FK_Projects_ProjectImports_ImportId")
  Owner                   Users            @relation(fields: [OwnerId], references: [Id], onUpdate: NoAction, map: "FK_Projects_Users_OwnerId")
  Reviewers               Reviewers[]

  @@index([GroupId], map: "IX_Projects_GroupId")
  @@index([ImportId], map: "IX_Projects_ImportId")
  @@index([OrganizationId], map: "IX_Projects_OrganizationId")
  @@index([OwnerId], map: "IX_Projects_OwnerId")
  @@index([TypeId], map: "IX_Projects_TypeId")
}

model Reviewers {
  Id        Int      @id(map: "PK_Reviewers") @default(autoincrement())
  Name      String
  Email     String
  ProjectId Int
  Locale    String
  Project   Projects @relation(fields: [ProjectId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_Reviewers_Projects_ProjectId")

  @@index([ProjectId], map: "IX_Reviewers_ProjectId")
}

model StoreLanguages {
  Id          Int        @id(map: "PK_StoreLanguages") @default(autoincrement())
  Name        String
  Description String?
  StoreTypeId Int
  Products    Products[]
  StoreType   StoreTypes @relation(fields: [StoreTypeId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_StoreLanguages_StoreTypes_StoreTypeId")

  @@index([StoreTypeId], map: "IX_StoreLanguages_StoreTypeId")
}

model StoreTypes {
  Id                  Int                   @id(map: "PK_StoreTypes") @default(autoincrement())
  Name                String
  Description         String?
  StoreLanguages      StoreLanguages[]
  Stores              Stores[]
  WorkflowDefinitions WorkflowDefinitions[]
}

model Stores {
  Id                     Int             @id(map: "PK_Stores") @default(autoincrement())
  BuildEnginePublisherId String
  Description            String?
  StoreTypeId            Int
  GooglePlayTitle        String?
  OwnerId                Int?
  Organizations          Organizations[] @relation("OrganizationsToStores")
  Products               Products[]
  StoreType              StoreTypes      @relation(fields: [StoreTypeId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_Stores_StoreTypes_StoreTypeId")
  Owner                  Organizations?  @relation(name: "ManagedStores", fields: [OwnerId], references: [Id], onDelete: SetNull, onUpdate: NoAction, map: "FK_Stores_Organizations_OwnerId")

  @@index([StoreTypeId], map: "IX_Stores_StoreTypeId")
}

model SystemStatuses {
  Id                        Int       @id(map: "PK_SystemStatuses") @default(autoincrement())
  BuildEngineUrl            String?
  BuildEngineApiAccessToken String?
  SystemAvailable           Boolean
  DateCreated               DateTime? @default(now()) @db.Timestamp(6)
  DateUpdated               DateTime? @updatedAt @db.Timestamp(6)
}

model SystemVersions {
  BuildEngineUrl    String // weak link to SystemStatuses table
  ApplicationTypeId Int
  Version           String?          @default("13.2") // defaulting to 13.2 because this is what BuildEngine supports at this time
  DateCreated       DateTime?        @default(now()) @db.Timestamp(6)
  DateUpdated       DateTime?        @updatedAt @db.Timestamp(6)
  ImageHash         String?
  ApplicationType   ApplicationTypes @relation(fields: [ApplicationTypeId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_SystemVersions_ApplicationTypes_ ApplicationTypeId")

  @@id([BuildEngineUrl, ApplicationTypeId], map: "PK_SystemVersions_BuildEngineUrl_ApplicationTypeId")
}

model SoftwareUpdates {
  Id                Int              @id(map: "PK_SoftwareUpdates") @default(autoincrement())
  InitiatedById     Int
  Comment           String
  Paused            Boolean          @default(false)
  DateCreated       DateTime?        @default(now()) @db.Timestamp(6)
  DateUpdated       DateTime?        @updatedAt @db.Timestamp(6)
  DateCompleted     DateTime?        @db.Timestamp(6)
  // Version information
  BuildEngineUrl    String
  ApplicationTypeId Int
  Version           String
  InitiatedBy       Users            @relation(fields: [InitiatedById], references: [Id])
  ApplicationType   ApplicationTypes @relation(fields: [ApplicationTypeId], references: [Id])
  // Implicit m-n table. Org and project reachable through this relation
  Products          Products[]
}

model UserRoles {
  UserId         Int
  RoleId         Int
  OrganizationId Int
  Organization   Organizations @relation(fields: [OrganizationId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_UserRoles_Organizations_OrganizationId")
  User           Users         @relation(fields: [UserId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_UserRoles_Users_UserId")

  @@id([UserId, RoleId, OrganizationId], map: "PK_UserRoles_UserId_RoleId_OrganizationId")
}

model UserTasks {
  Id             Int                  @id(map: "PK_UserTasks") @default(autoincrement())
  UserId         Int
  ProductId      String               @db.Uuid
  ActivityName   String?
  Status         String?
  Comment        String?
  DateCreated    DateTime?            @default(now()) @db.Timestamp(6)
  DateUpdated    DateTime?            @updatedAt @db.Timestamp(6)
  Role           Int                  @default(3) // AppBuilder (i.e. the Project Owner)
  Type           Int                  @default(1) // Workflow
  Product        Products             @relation(fields: [ProductId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_UserTasks_Products_ProductId")
  User           Users                @relation(fields: [UserId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_UserTasks_Users_UserId")
  // This is defined as a separate table so we don't have to add a new field to UserTasks
  ChangeRequests ProductUserChanges[]

  @@index([ProductId], map: "IX_UserTasks_ProductId")
  @@index([UserId], map: "IX_UserTasks_UserId")
}

model Users {
  Id                            Int                             @id(map: "PK_Users") @default(autoincrement())
  Name                          String?
  GivenName                     String?
  FamilyName                    String?
  Email                         String?
  Phone                         String?
  Timezone                      String?
  Locale                        String?
  IsLocked                      Boolean
  ExternalId                    String?
  ProfileVisibility             Int                             @default(1)
  EmailNotification             Boolean                         @default(true)
  NotificationOptions           Int[]                           @default([])
  DateCreated                   DateTime?                       @default(now()) @db.Timestamp(6)
  DateUpdated                   DateTime?                       @updatedAt @db.Timestamp(6)
  Authors                       Authors[]
  Groups                        Groups[]
  OrganizationMembershipInvites OrganizationMembershipInvites[]
  Organizations                 Organizations[]
  ProjectImports                ProjectImports[]
  Projects                      Projects[]
  UserRoles                     UserRoles[]
  UserTasks                     UserTasks[]
  ProductTransitions            ProductTransitions[]
  SoftwareUpdates               SoftwareUpdates[]
}

model WorkflowDefinitions {
  Id                          Int                  @id(map: "PK_WorkflowDefinitions") @default(autoincrement())
  Name                        String
  Enabled                     Boolean
  Description                 String?
  StoreTypeId                 Int
  Type                        Int                  @default(1)
  Properties                  String?
  RebuildProductDefinitions   ProductDefinitions[] @relation("ProductDefinitions_RebuildWorkflowIdToWorkflowDefinitions")
  RepublishProductDefinitions ProductDefinitions[] @relation("ProductDefinitions_RepublishWorkflowIdToWorkflowDefinitions")
  ProductDefinitions          ProductDefinitions[] @relation("ProductDefinitions_WorkflowIdToWorkflowDefinitions")
  StoreType                   StoreTypes?          @relation(fields: [StoreTypeId], references: [Id], onDelete: Restrict, onUpdate: NoAction, map: "FK_WorkflowDefinitions_StoreTypes_StoreTypeId")
  ProductType                 Int                  @default(0)
  WorkflowOptions             Int[]                @default([])
  WorkflowInstances           WorkflowInstances[]

  @@index([StoreTypeId], map: "IX_WorkflowDefinitions_StoreTypeId")
}

model ProductUserChanges {
  Id               String      @id(map: "PK_ProductUserChanges") @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  ProductId        String      @db.Uuid
  Email            String?
  Change           String?
  DateCreated      DateTime?   @default(now()) @db.Timestamp(6)
  DateUpdated      DateTime?   @updatedAt @db.Timestamp(6)
  DateCompleted    DateTime?   @db.Timestamp(6)
  ConfirmationCode String
  DateExpires      DateTime    @db.Timestamp(6)
  DateConfirmed    DateTime?   @db.Timestamp(6)
  Product          Products    @relation(fields: [ProductId], references: [Id], onDelete: Cascade, onUpdate: NoAction, map: "FK_ProductUserChanges_Products_ProductId")
  Tasks            UserTasks[]

  @@index([ProductId], map: "IX_ProductUserChanges_ProductId")
}

model WorkflowInstances {
  State                String
  Context              String
  WorkflowDefinitionId Int
  ProductId            String              @id(map: "PK_WorkflowInstances") @db.Uuid
  DateCreated          DateTime?           @default(now()) @db.Timestamp
  DateUpdated          DateTime?           @updatedAt @db.Timestamp
  Product              Products            @relation(fields: [ProductId], references: [Id], onDelete: NoAction, onUpdate: NoAction, map: "FK_WorkflowInstances_Products_ProductId")
  WorkflowDefinition   WorkflowDefinitions @relation(fields: [WorkflowDefinitionId], references: [Id], onDelete: NoAction, onUpdate: NoAction, map: "FK_WorkflowInstances_WorkflowDefinitions_WorkflowDefinitionId")
}
